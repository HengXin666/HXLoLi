"use strict";(self.webpackChunkhx_loli=self.webpackChunkhx_loli||[]).push([[29665],{21001:e=>{e.exports=JSON.parse('{"permalink":"/HXLoLi/blog/2025/09/07/01-MSVC\u7684requires\u7f3a\u9677","editUrl":"https://github.com/HengXin666/HXLoLi/edit/main/blog/2025/09/07/01-MSVC\u7684requires\u7f3a\u9677.md","source":"@site/blog/2025/09/07/01-MSVC\u7684requires\u7f3a\u9677.md","title":"MSVC\u7684requires\u7f3a\u9677","description":"[!TIP]","date":"2025-09-07T16:43:37.000Z","tags":[{"inline":false,"label":"C++","permalink":"/HXLoLi/blog/tags/C++","description":"C++\u5c0f\u77e5\u8bc6"}],"readingTime":2.605,"hasTruncateMarker":true,"authors":[{"name":"Heng_Xin","title":"\u3053\u3053\u304b\u3089\u5148\u306f\u4e00\u65b9\u901a\u884c\u3060!","url":"https://github.com/HengXin666","email":"282000500@qq.com","socials":{"github":"https://github.com/HengXin666","bilibili":"https://space.bilibili.com/478917126"},"imageURL":"https://avatars.githubusercontent.com/u/103022267","key":"Heng_Xin","page":null}],"frontMatter":{"authors":"Heng_Xin","title":"MSVC\u7684requires\u7f3a\u9677","date":"2025-09-07T16:43:37.000Z","tags":["C++"]},"unlisted":false,"lastUpdatedAt":1757863164000,"lastUpdatedBy":"Heng_Xin_666","prevItem":{"title":"\u3010C++\u3011\u5982\u4f55\u5c06\u300c\u5b57\u7b26\u4e32\u300d\u4f5c\u4e3a\u300c\u975e\u7c7b\u578b\u6a21\u677f\u5b9e\u53c2\u300d","permalink":"/HXLoLi/blog/2025/09/14/01-\u5b57\u7b26\u4e32\u4f5c\u4e3a\u975e\u7c7b\u578b\u6a21\u677f\u5b9e\u53c2"},"nextItem":{"title":"QML \u652f\u6301 Wayland \u6bd4 QWidget \u597d!","permalink":"/HXLoLi/blog/2025/08/13/01-QML\u4e07\u5c81"}}')},28453:(e,n,t)=>{t.d(n,{R:()=>u,x:()=>a});var r=t(96540);const i={},s=r.createContext(i);function u(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:u(e.components),r.createElement(s.Provider,{value:n},e.children)}},54678:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>u,metadata:()=>r,toc:()=>l});var r=t(21001),i=t(74848),s=t(28453);const u={authors:"Heng_Xin",title:"MSVC\u7684requires\u7f3a\u9677",date:new Date("2025-09-07T16:43:37.000Z"),tags:["C++"]},a=void 0,c={authorsImageUrls:[void 0]},l=[{value:"msvc\u7b7e\u540d\u4e0d\u5b8c\u5168\u5339\u914d: requires \u7f3a\u9677",id:"msvc\u7b7e\u540d\u4e0d\u5b8c\u5168\u5339\u914d-requires-\u7f3a\u9677",level:2}];function o(e){const n={a:"a",code:"code",div:"div",h2:"h2",p:"p",pre:"pre",span:"span",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-tip",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",children:[(0,i.jsx)(n.span,{className:"octicon octicon-tip",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-light-bulb mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Tip"]}),"\n",(0,i.jsx)(n.p,{children:"\u672c\u6587\u53ea\u6709\u6076\u610f. win\u90fd\ud83d\udca9! MS\ud83d\udca9VC!"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"msvc\u7b7e\u540d\u4e0d\u5b8c\u5168\u5339\u914d-requires-\u7f3a\u9677",children:"msvc\u7b7e\u540d\u4e0d\u5b8c\u5168\u5339\u914d: requires \u7f3a\u9677"}),"\n",(0,i.jsxs)(n.p,{children:["\u4eca\u5929\u4e0awin, \u987a\u4fbf\u628a\u4e4b\u524d\u7684msvc bug \u4fee\u590d. \u7ed3\u679c\u53d1\u73b0: (",(0,i.jsx)(n.a,{href:"https://github.com/HengXin666/HXLibs/issues/13",children:"#13"}),")"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"D:\\command\\Github\\HXLibs\\tests\\client\\02_ws_client.cpp\n[build] D:\\command\\Github\\HXLibs\\include\\HXLibs/container/ThreadPool.hpp(338): error C2244: \u201cHX::container::FutureResult<T>::thenTry\u201d: \u65e0\u6cd5\u5c06\u51fd\u6570\u5b9a\u4e49\u4e0e\u73b0\u6709\u7684\u58f0\u660e\u5339\u914d\n[build] D:\\command\\Github\\HXLibs\\include\\HXLibs/container/ThreadPool.hpp(338): note: \u53c2\u89c1\u201cHX::container::FutureResult<T>::thenTry\u201d\u7684\u58f0\u660e\n[build] D:\\command\\Github\\HXLibs\\include\\HXLibs/container/ThreadPool.hpp(338): note: \u5b9a\u4e49\n[build] D:\\command\\Github\\HXLibs\\include\\HXLibs/container/ThreadPool.hpp(338): note: 'HX::container::FutureResult<internal::RemoveTryWarpImpl<Res>::Type> HX::container::FutureResult<T>::thenTry(Func &&) noexcept &&'\n[build] D:\\command\\Github\\HXLibs\\include\\HXLibs/container/ThreadPool.hpp(338): note: \u73b0\u6709\u58f0\u660e\n[build] D:\\command\\Github\\HXLibs\\include\\HXLibs/container/FutureResult.hpp(127): note: 'HX::container::FutureResult<internal::RemoveTryWarpImpl<Res>::Type> HX::container::FutureResult<T>::thenTry(Func &&) noexcept &&'\n[build] ninja: build stopped: subcommand failed.\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7ecf\u8fc7\u6392\u67e5, \u53d1\u73b0\u662f msvc \u7684\u7f3a\u9677. \u8981\u6c42 requires \u5728\u51fd\u6570\u7b7e\u540d\u4e2d\u5e94\u8be5\u5b8c\u5168\u4e00\u6837, \u624d\u4f1a\u89c6\u4f5c\u51fd\u6570\u7b7e\u540d\u4e00\u6837."}),"\n",(0,i.jsxs)(n.p,{children:["\u4ee5\u4e0b\u662f\u590d\u73b0\u6848\u4f8b: ",(0,i.jsx)(n.a,{href:"https://godbolt.org/z/EWhrdsoK6",children:"https://godbolt.org/z/EWhrdsoK6"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"#include <utility>\n#include <type_traits>\n\ntemplate <typename T = void>\nstruct Try {\n    using TryType = T;\n};\n\nnamespace internal {\n\ntemplate <typename T>\nstruct RemoveTryWarpImpl {\n    using Type = T;\n};\n\ntemplate <typename T>\nstruct RemoveTryWarpImpl<Try<T>> {\n    using Type = T;\n};\n\n} // namespace internal\n\ntemplate <typename T>\nusing RemoveTryWarpType = internal::RemoveTryWarpImpl<T>::Type;\n\ntemplate <typename T = void>\nclass FutureResult {\npublic:\n    using TryType = Try<RemoveTryWarpType<T>>;\n\n    template <typename Func, typename Res = std::invoke_result_t<Func, TryType>>\n    requires (requires (Func func, TryType t) { // \u5e94\u8be5\u5199\u4e3a FutureResult<T>::TryType\n        func(std::move(t));                     // MSVC\u7684\u9519\u8bef\u662f\u7b7e\u540d\u4e0d\u5b8c\u5168\u5339\u914d,\n                                                // \u539f\u56e0\u662frequires\u8868\u8fbe\u5f0f\u5199\u5728\u4e86\u7c7b\u6a21\u677f\u58f0\u660e\u548c\u5b9a\u4e49\u4e0a,\n                                                // \u4f46\u662fMSVC\u5bf9\u8fd9\u7c7b\u60c5\u51b5\u7684\u89e3\u6790\u6709bug,\n                                                // \u5177\u4f53\u662f [requires\u5fc5\u987b\u4e00\u6a21\u4e00\u6837, \u5426\u5219\u89c6\u4e3a\u4e0d\u540c\u51fd\u6570]\u3002\n                                                // requires\u8868\u8fbe\u5f0f\u91cc\u7c7b\u578b\u5199\u6cd5\u4e0d\u4e00\u81f4, \u5bfc\u81f4MSVC\u65e0\u6cd5\u5339\u914d\u3002\n    })\n    FutureResult<RemoveTryWarpType<Res>> thenTry(Func&& func) && noexcept;\n};\n\ntemplate <typename T>\ntemplate <typename Func, typename Res>\n    requires (requires (Func func, FutureResult<T>::TryType t) {\n            func(std::move(t));\n        })\nFutureResult<RemoveTryWarpType<Res>> FutureResult<T>::thenTry(\n    Func&& func\n) && noexcept { return {}; }\n\nint main() {\n    FutureResult<int> f;\n    auto res = std::move(f).thenTry([](Try<int> x) { \n        return x; \n    });\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u66f4\u52a0\u7b80\u5355\u7684, \u6700\u5c0f\u590d\u73b0\u6848\u4f8b: ",(0,i.jsx)(n.a,{href:"https://godbolt.org/z/xG1cjjbca",children:"https://godbolt.org/z/xG1cjjbca"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"#include <utility>\n#include <type_traits>\n\ntemplate <typename T = void>\nstruct Try { using TryType = T; };\n\ntemplate <typename T = void>\nclass FutureResult {\npublic:\n    using TryType = Try<T>;\n\n    template <typename Func>\n    requires requires(Func func, TryType t) { func(std::move(t)); }\n    FutureResult thenTry(Func&& func) && noexcept;\n};\n\ntemplate <typename T>\ntemplate <typename Func>\nrequires requires(Func func, typename FutureResult<T>::TryType t) { func(std::move(t)); }\nFutureResult<T> FutureResult<T>::thenTry(Func&& func) && noexcept {\n    return {};\n}\n\nint main() {\n    FutureResult<int> f;\n    std::move(f).thenTry([](Try<int> x) { return x; });\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5df2\u7ecf\u53d1\u9001\u7ed9 msvc \u4e86 (",(0,i.jsx)(n.a,{href:"https://developercommunity.visualstudio.com/t/MSVC-rejects-definitions-when-requires-c/10961820",children:"https://developercommunity.visualstudio.com/t/MSVC-rejects-definitions-when-requires-c/10961820"}),") (\u6211\u624d\u4e0d\u7ba1\u662f\u5426\u6709\u91cd\u590d\u63d0\u6848\u5462..tm\u7684\u8fd9\u4e48\u4e45\u4e86\u90fd\u8fd8\u6709\u8fd9\u4e2abug..., \u7ba1\u5b83\u662f\u4e0d\u662fbug\u5462. gcc/clang \u600e\u4e48\u53c8ok?)"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}}}]);